Create a comprehensive user profile editing system with photo upload, contact details, and social media integration.

REQUIREMENTS:

1. CREATE ENHANCED PROFILE SCREEN:

// screens/ProfileEditScreen.js

import * as ImagePicker from 'expo-image-picker';
import { getStorage, ref, uploadBytes, getDownloadURL } from 'firebase/storage';

export default function ProfileEditScreen({ navigation }) {
const [userData, setUserData] = useState({
username: '',
displayName: '',
email: '',
phoneNumber: '',
photoURL: null,
bio: '',
socialMedia: {
instagram: '',
twitter: '',
facebook: '',
},
});
const [uploading, setUploading] = useState(false);
const [hasChanges, setHasChanges] = useState(false);

useEffect(() => {
loadUserProfile();
}, []);

const loadUserProfile = async () => {
const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
const data = userDoc.data();
setUserData({
  username: data.username || '',
  displayName: data.displayName || '',
  email: data.email || auth.currentUser.email,
  phoneNumber: data.phoneNumber || '',
  photoURL: data.photoURL || null,
  bio: data.bio || '',
  socialMedia: data.socialMedia || {
    instagram: '',
    twitter: '',
    facebook: '',
  },
});
};

const pickImage = async () => {
// Request permission
const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();
if (status !== 'granted') {
  Alert.alert('Permission Denied', 'We need camera roll permissions to upload a photo.');
  return;
}

// Launch image picker
const result = await ImagePicker.launchImageLibraryAsync({
  mediaTypes: ImagePicker.MediaTypeOptions.Images,
  allowsEditing: true,
  aspect:,[1]
  quality: 0.5,
});

if (!result.canceled) {
  uploadImage(result.assets.uri);
}
};

const uploadImage = async (uri) => {
setUploading(true);
try {
  // Convert to blob
  const response = await fetch(uri);
  const blob = await response.blob();

  // Upload to Firebase Storage
  const storage = getStorage();
  const storageRef = ref(storage, `profilePhotos/${auth.currentUser.uid}`);
  
  await uploadBytes(storageRef, blob);
  const downloadURL = await getDownloadURL(storageRef);

  // Update local state
  setUserData({ ...userData, photoURL: downloadURL });
  setHasChanges(true);
  
  Alert.alert('Success', 'Photo uploaded!');
} catch (error) {
  Alert.alert('Upload Error', error.message);
} finally {
  setUploading(false);
}
};

const connectSocialMedia = async (platform) => {
// For MVP - manual input
// In production, integrate OAuth for each platform
Alert.prompt(
  `Connect ${platform}`,
  `Enter your ${platform} username:`,
  [
    { text: 'Cancel', style: 'cancel' },
    {
      text: 'Save',
      onPress: (username) => {
        setUserData({
          ...userData,
          socialMedia: {
            ...userData.socialMedia,
            [platform.toLowerCase()]: username,
          },
        });
        setHasChanges(true);
      },
    },
  ],
  'plain-text'
);

};

const fetchSocialMediaInfo = async (platform) => {
// In production, use social media APIs
Alert.alert(
'Fetch Info',
This would fetch your name and photo from ${platform}.\n\nFor demo: Feature coming soon!
);
};

const saveProfile = async () => {
try {
await updateDoc(doc(db, 'users', auth.currentUser.uid), {
displayName: userData.displayName,
phoneNumber: userData.phoneNumber,
photoURL: userData.photoURL,
bio: userData.bio,
socialMedia: userData.socialMedia,
profileUpdatedAt: new Date(),
});
  Alert.alert('Success', 'Profile updated!');
  setHasChanges(false);
  navigation.goBack();
} catch (error) {
  Alert.alert('Error', error.message);
}

};

return (
<ScrollView style={styles.container}>
{/* Header */}
<View style={styles.header}>
<Text style={styles.title}>Edit Profile</Text>
</View>
  {/* Photo Upload */}
  <View style={styles.photoSection}>
    <TouchableOpacity onPress={pickImage} disabled={uploading}>
      {userData.photoURL ? (
        <Image
          source={{ uri: userData.photoURL }}
          style={styles.profilePhoto}
        />
      ) : (
        <View style={styles.photoPlaceholder}>
          <Text style={styles.photoPlaceholderText}>
            {userData.username.charAt(0).toUpperCase()}
          </Text>
        </View>
      )}
      <View style={styles.editPhotoBadge}>
        <Text style={styles.editPhotoIcon}>
          {uploading ? '‚è≥' : 'üì∑'}
        </Text>
      </View>
    </TouchableOpacity>
    <Text style={styles.photoHint}>Tap to change photo</Text>
  </View>

  {/* Basic Info */}
  <View style={styles.section}>
    <Text style={styles.sectionTitle}>Basic Information</Text>

    <View style={styles.inputGroup}>
      <Text style={styles.label}>Username (Public)</Text>
      <TextInput
        style={[styles.input, styles.inputDisabled]}
        value={userData.username}
        editable={false}
      />
      <Text style={styles.hint}>Username cannot be changed</Text>
    </View>

    <View style={styles.inputGroup}>
      <Text style={styles.label}>Display Name</Text>
      <TextInput
        style={styles.input}
        value={userData.displayName}
        onChangeText={(text) => {
          setUserData({ ...userData, displayName: text });
          setHasChanges(true);
        }}
        placeholder="Your full name"
        maxLength={50}
      />
    </View>

    <View style={styles.inputGroup}>
      <Text style={styles.label}>Bio</Text>
      <TextInput
        style={[styles.input, styles.textArea]}
        value={userData.bio}
        onChangeText={(text) => {
          setUserData({ ...userData, bio: text });
          setHasChanges(true);
        }}
        placeholder="Tell others about yourself..."
        multiline
        numberOfLines={3}
        maxLength={150}
      />
      <Text style={styles.charCount}>
        {userData.bio.length}/150
      </Text>
    </View>
  </View>

  {/* Contact Info */}
  <View style={styles.section}>
    <Text style={styles.sectionTitle}>Contact Information</Text>

    <View style={styles.inputGroup}>
      <Text style={styles.label}>Email</Text>
      <TextInput
        style={[styles.input, styles.inputDisabled]}
        value={userData.email}
        editable={false}
      />
      <Text style={styles.hint}>Email is managed in account settings</Text>
    </View>

    <View style={styles.inputGroup}>
      <Text style={styles.label}>Phone Number (Optional)</Text>
      <TextInput
        style={styles.input}
        value={userData.phoneNumber}
        onChangeText={(text) => {
          setUserData({ ...userData, phoneNumber: text });
          setHasChanges(true);
        }}
        placeholder="+1 (555) 123-4567"
        keyboardType="phone-pad"
        maxLength={20}
      />
    </View>
  </View>

  {/* Social Media Connections */}
  <View style={styles.section}>
    <Text style={styles.sectionTitle}>Social Media</Text>
    <Text style={styles.sectionSubtitle}>
      Connect your accounts to share achievements
    </Text>

    {/* Instagram */}
    <View style={styles.socialCard}>
      <View style={styles.socialInfo}>
        <Text style={styles.socialIcon}>üì∑</Text>
        <View style={styles.socialText}>
          <Text style={styles.socialName}>Instagram</Text>
          {userData.socialMedia.instagram ? (
            <Text style={styles.socialUsername}>
              @{userData.socialMedia.instagram}
            </Text>
          ) : (
            <Text style={styles.socialDisconnected}>Not connected</Text>
          )}
        </View>
      </View>
      <View style={styles.socialActions}>
        {userData.socialMedia.instagram ? (
          <>
            <TouchableOpacity
              style={styles.fetchBtn}
              onPress={() => fetchSocialMediaInfo('Instagram')}
            >
              <Text style={styles.fetchBtnText}>Fetch Info</Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={styles.disconnectBtn}
              onPress={() => {
                setUserData({
                  ...userData,
                  socialMedia: { ...userData.socialMedia, instagram: '' },
                });
                setHasChanges(true);
              }}
            >
              <Text style={styles.disconnectBtnText}>Disconnect</Text>
            </TouchableOpacity>
          </>
        ) : (
          <TouchableOpacity
            style={styles.connectBtn}
            onPress={() => connectSocialMedia('Instagram')}
          >
            <Text style={styles.connectBtnText}>Connect</Text>
          </TouchableOpacity>
        )}
      </View>
    </View>

    {/* Twitter */}
    <View style={styles.socialCard}>
      <View style={styles.socialInfo}>
        <Text style={styles.socialIcon}>üê¶</Text>
        <View style={styles.socialText}>
          <Text style={styles.socialName}>Twitter</Text>
          {userData.socialMedia.twitter ? (
            <Text style={styles.socialUsername}>
              @{userData.socialMedia.twitter}
            </Text>
          ) : (
            <Text style={styles.socialDisconnected}>Not connected</Text>
          )}
        </View>
      </View>
      <View style={styles.socialActions}>
        {userData.socialMedia.twitter ? (
          <>
            <TouchableOpacity
              style={styles.fetchBtn}
              onPress={() => fetchSocialMediaInfo('Twitter')}
            >
              <Text style={styles.fetchBtnText}>Fetch Info</Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={styles.disconnectBtn}
              onPress={() => {
                setUserData({
                  ...userData,
                  socialMedia: { ...userData.socialMedia, twitter: '' },
                });
                setHasChanges(true);
              }}
            >
              <Text style={styles.disconnectBtnText}>Disconnect</Text>
            </TouchableOpacity>
          </>
        ) : (
          <TouchableOpacity
            style={styles.connectBtn}
            onPress={() => connectSocialMedia('Twitter')}
          >
            <Text style={styles.connectBtnText}>Connect</Text>
          </TouchableOpacity>
        )}
      </View>
    </View>

    {/* Facebook */}
    <View style={styles.socialCard}>
      <View style={styles.socialInfo}>
        <Text style={styles.socialIcon}>üë§</Text>
        <View style={styles.socialText}>
          <Text style={styles.socialName}>Facebook</Text>
          {userData.socialMedia.facebook ? (
            <Text style={styles.socialUsername}>
              {userData.socialMedia.facebook}
            </Text>
          ) : (
            <Text style={styles.socialDisconnected}>Not connected</Text>
          )}
        </View>
      </View>
      <View style={styles.socialActions}>
        {userData.socialMedia.facebook ? (
          <>
            <TouchableOpacity
              style={styles.fetchBtn}
              onPress={() => fetchSocialMediaInfo('Facebook')}
            >
              <Text style={styles.fetchBtnText}>Fetch Info</Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={styles.disconnectBtn}
              onPress={() => {
                setUserData({
                  ...userData,
                  socialMedia: { ...userData.socialMedia, facebook: '' },
                });
                setHasChanges(true);
              }}
            >
              <Text style={styles.disconnectBtnText}>Disconnect</Text>
            </TouchableOpacity>
          </>
        ) : (
          <TouchableOpacity
            style={styles.connectBtn}
            onPress={() => connectSocialMedia('Facebook')}
          >
            <Text style={styles.connectBtnText}>Connect</Text>
          </TouchableOpacity>
        )}
      </View>
    </View>
  </View>

  {/* Save Button */}
  <TouchableOpacity
    style={[styles.saveBtn, !hasChanges && styles.saveBtnDisabled]}
    onPress={saveProfile}
    disabled={!hasChanges}
  >
    <Text style={styles.saveBtnText}>
      {hasChanges ? 'Save Changes' : 'No Changes'}
    </Text>
  </TouchableOpacity>

  <View style={{ height: 40 }} />
</ScrollView>

);
}


2. INSTALL DEPENDENCIES:

npx expo install expo-image-picker
npm install firebase/storage


3. FIREBASE STORAGE SETUP:

Configure Firebase Storage in Firebase Console:
- Go to Storage section
- Set up security rules:

rules_version = '2';
service firebase.storage {
match /b/{bucket}/o {
match /profilePhotos/{userId} {
allow read: if true;
allow write: if request.auth != null && request.auth.uid == userId
&& request.resource.size < 5 * 1024 * 1024 // 5MB limit
&& request.resource.contentType.matches('image/.*');
}
}
}


4. ADD TO NAVIGATION:

// In ProfileScreen.js, add edit button
<TouchableOpacity
style={styles.editBtn}
onPress={() => navigation.navigate('ProfileEdit')}

<Text style={styles.editBtnText}>Edit Profile</Text>
</TouchableOpacity>


Create comprehensive profile editing with:
- Photo upload with preview
- Display name and bio editing
- Phone number (optional)
- Social media connections
- Fetch info from social platforms
- Form validation
- Unsaved changes warning
- Firebase Storage integration

Implement social media sharing for achievements, leaderboard rankings, and app promotion.

REQUIREMENTS:

1. INSTALL SHARING MODULE:

npx expo install expo-sharing
npx expo install expo-file-system
npx expo install react-native-view-shot


2. CREATE SHARING MANAGER:

// utils/sharingManager.js

import * as Sharing from 'expo-sharing';
import * as FileSystem from 'expo-file-system';
import { captureRef } from 'react-native-view-shot';

export const SHARE_TEMPLATES = {
levelUp: {
title: 'Level Up!',
getMessage: (level, petName) =>
üéâ My ${petName} just reached Level ${level} in PetFit Champions! Building healthy habits one day at a time. Join me! #PetFitChampions #HealthyLiving,
},
leaderboard: {
title: 'Leaderboard Ranking',
getMessage: (rank, category) =>
üèÜ I'm ranked #${rank} in ${category} on PetFit Champions! Competing with the best while staying healthy. #PetFitChampions #FitnessGoals,
},
streak: {
title: 'Streak Achievement',
getMessage: (days) =>
üî• ${days}-day streak on PetFit Champions! Consistency is key to building lasting healthy habits. #HealthStreak #PetFitChampions,
},
raidVictory: {
title: 'Raid Victory',
getMessage: (bossName) =>
‚öîÔ∏è We defeated ${bossName} in a community raid! Join thousands building better health together. #PetFitChampions #CommunityHealth,
},
appInvite: {
title: 'Join PetFit Champions',
getMessage: () =>
üêæ I'm building healthy habits with PetFit Champions! It's like Pok√©mon but for real health goals. Join me and let's grow together! Download now: [APP_LINK],
},
};

export const shareText = async (template, data = {}) => {
const shareData = SHARE_TEMPLATES[template];
const message = shareData.getMessage(...Object.values(data));

if (await Sharing.isAvailableAsync()) {
await Sharing.shareAsync('', {
mimeType: 'text/plain',
dialogTitle: shareData.title,
UTI: 'public.text',
});
} else {
// Fallback for web or unsupported platforms
if (navigator.share) {
await navigator.share({
title: shareData.title,
text: message,
});
} else {
// Copy to clipboard
Alert.alert('Share', message);
}
}
};

export const shareImage = async (viewRef, template, data = {}) => {
try {
// Capture screenshot of view
const uri = await captureRef(viewRef, {
format: 'png',
quality: 0.9,
});
// Share the image
if (await Sharing.isAvailableAsync()) {
  const shareData = SHARE_TEMPLATES[template];
  const message = shareData.getMessage(...Object.values(data));
  
  await Sharing.shareAsync(uri, {
    mimeType: 'image/png',
    dialogTitle: shareData.title,
    UTI: 'public.image',
  });
}
} catch (error) {
Alert.alert('Share Error', error.message);
}
};


3. CREATE SHAREABLE CARDS:

// components/ShareCard.js

export const LevelUpShareCard = forwardRef(({ level, petName, petImage }, ref) => (
<View ref={ref} style={styles.shareCard}>
<LinearGradient
colors={['#32808D', '#5EB8C6']}
style={styles.gradient}
>
{/* App Branding */}
<View style={styles.branding}>
<Text style={styles.appName}>PetFit Champions</Text>
</View>
  {/* Achievement */}
  <View style={styles.achievement}>
    <Text style={styles.achievementIcon}>üéâ</Text>
    <Text style={styles.achievementTitle}>LEVEL UP!</Text>
    <Text style={styles.levelNumber}>{level}</Text>
  </View>

  {/* Pet Display */}
  <View style={styles.petDisplay}>
    <Image source={{ uri: petImage }} style={styles.petImage} />
    <Text style={styles.petName}>{petName}</Text>
  </View>

  {/* Call to Action */}
  <View style={styles.cta}>
    <Text style={styles.ctaText}>Join me in building healthy habits!</Text>
    <Text style={styles.appLink}>PetFitChampions.app</Text>
  </View>
</LinearGradient>
</View> ));
export const LeaderboardShareCard = forwardRef(({ rank, username, category, stats }, ref) => (
<View ref={ref} style={styles.shareCard}>
<LinearGradient
colors={['#FFD700', '#FFA500']}
style={styles.gradient}
>
<View style={styles.branding}>
<Text style={styles.appName}>PetFit Champions</Text>
</View>
  <View style={styles.achievement}>
    <Text style={styles.achievementIcon}>
      {rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : 'üèÜ'}
    </Text>
    <Text style={styles.rankNumber}>#{rank}</Text>
    <Text style={styles.categoryName}>{category}</Text>
  </View>

  <View style={styles.userInfo}>
    <Text style={styles.username}>{username}</Text>
    <Text style={styles.stats}>{stats}</Text>
  </View>

  <View style={styles.cta}>
    <Text style={styles.ctaText}>Can you beat my score?</Text>
    <Text style={styles.appLink}>PetFitChampions.app</Text>
  </View>
</LinearGradient>
</View> ));

4. INTEGRATE INTO SCREENS:

// In PetScreen.js - Level Up Share

const shareCardRef = useRef();

const handleShareLevelUp = async () => {
  Alert.alert(
    'Share Achievement',
    'Share your level-up achievement?',
    [
      { text: 'Cancel', style: 'cancel' },
      {
        text: 'Share Image',
        onPress: () => shareImage(shareCardRef, 'levelUp', {
          level: petLevel,
          petName: petData.name,
        }),
      },
      {
        text: 'Share Text',
        onPress: () => shareText('levelUp', {
          level: petLevel,
          petName: petData.name,
        }),
      },
    ]
  );
};

// Hidden share card (for screenshot)
<View style={{ position: 'absolute', left: -9999 }}>
  <LevelUpShareCard
    ref={shareCardRef}
    level={petLevel}
    petName={petData.name}
    petImage={petData.image}
  />
</View>

// Share button
<TouchableOpacity style={styles.shareBtn} onPress={handleShareLevelUp}>
  <Text style={styles.shareBtnText}>üì§ Share</Text>
</TouchableOpacity>
// In LeaderboardScreen.js - Ranking Share

const handleShareRanking = async (userRank) => {
  Alert.alert(
    'Share Ranking',
    'Brag about your leaderboard position?',
    [
      { text: 'Cancel', style: 'cancel' },
      {
        text: 'Share',
        onPress: () => shareText('leaderboard', {
          rank: userRank.position,
          category: activeTab,
        }),
      },
    ]
  );
};

// In HomeScreen.js - App Invite

const handleInviteFriends = async () => {
  await shareText('appInvite', {});
};

<TouchableOpacity style={styles.inviteBtn} onPress={handleInviteFriends}>
  <Text style={styles.inviteBtnText}>üì® Invite Friends</Text>
</TouchableOpacity>

5.SOCIAL SHARE BUTTONS:

// components/SocialShareButtons.js

export default function SocialShareButtons({ template, data }) {
  const shareToInstagram = async () => {
    // For Instagram, need to save image first
    const uri = await captureAndSaveImage();
    
    Linking.openURL(`instagram://library?AssetPath=${uri}`);
  };

  const shareToTwitter = () => {
    const message = SHARE_TEMPLATES[template].getMessage(...Object.values(data));
    const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
    Linking.openURL(tweetUrl);
  };

  const shareToFacebook = () => {
    const message = SHARE_TEMPLATES[template].getMessage(...Object.values(data));
    const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://petfitchampions.app')}&quote=${encodeURIComponent(message)}`;
    Linking.openURL(fbUrl);
  };

  return (
    <View style={styles.socialButtons}>
      <TouchableOpacity style={styles.socialBtn} onPress={shareToInstagram}>
        <Text style={styles.socialIcon}>üì∑</Text>
        <Text style={styles.socialText}>Instagram</Text>
      </TouchableOpacity>

      <TouchableOpacity style={styles.socialBtn} onPress={shareToTwitter}>
        <Text style={styles.socialIcon}>üê¶</Text>
        <Text style={styles.socialText}>Twitter</Text>
      </TouchableOpacity>

      <TouchableOpacity style={styles.socialBtn} onPress={shareToFacebook}>
        <Text style={styles.socialIcon}>üë§</Text>
        <Text style={styles.socialText}>Facebook</Text>
      </TouchableOpacity>

      <TouchableOpacity style={styles.socialBtn} onPress={() => shareText(template, data)}>
        <Text style={styles.socialIcon}>üì§</Text>
        <Text style={styles.socialText}>More</Text>
      </TouchableOpacity>
    </View>
  );
}

6.REFERRAL TRACKING:

// Track referrals in Firebase

const generateReferralCode = (userId) => {
  return userId.substring(0, 8).toUpperCase();
};

const trackReferral = async (referralCode) => {
  const usersRef = collection(db, 'users');
  const q = query(usersRef, where('referralCode', '==', referralCode));
  const snapshot = await getDocs(q);
  
  if (!snapshot.empty) {
    const referrer = snapshot.docs;
    
    // Award bonus to referrer
    await updateDoc(doc(db, 'users', referrer.id), {
      gems: increment(50), // Referral bonus
      referrals: increment(1),
    });
    
    // Award bonus to new user
    await updateDoc(doc(db, 'users', auth.currentUser.uid), {
      gems: increment(25),
      referredBy: referrer.id,
    });
  }
};

Create complete sharing system with:

Text and image sharing

Customizable share templates

Beautiful shareable cards

Platform-specific sharing (Instagram, Twitter, Facebook)

Referral tracking

App invite system


HEALTH APP INTEGRATION (APPLE/GOOGLE FIT)

Integrate with Apple Health and Google Fit to automatically sync health data instead of manual entry.

REQUIREMENTS:

1. INSTALL HEALTH KIT:
npx expo install expo-apple-healthkit
npx expo install react-native-google-fit

2.CREATE HEALTH SYNC MANAGER:

// utils/healthSyncManager.js

import AppleHealthKit from 'expo-apple-healthkit';
import GoogleFit, { Scopes } from 'react-native-google-fit';
import { Platform } from 'react-native';

const HEALTH_PERMISSIONS = {
  permissions: {
    read: [
      AppleHealthKit.Constants.Permissions.Steps,
      AppleHealthKit.Constants.Permissions.HeartRate,
      AppleHealthKit.Constants.Permissions.SleepAnalysis,
      AppleHealthKit.Constants.Permissions.ActiveEnergyBurned,
      AppleHealthKit.Constants.Permissions.DistanceWalkingRunning,
    ],
  },
};

const GOOGLE_FIT_OPTIONS = {
  scopes: [
    Scopes.FITNESS_ACTIVITY_READ,
    Scopes.FITNESS_BODY_READ,
    Scopes.FITNESS_LOCATION_READ,
  ],
};

export const initializeHealthKit = async () => {
  if (Platform.OS === 'ios') {
    return new Promise((resolve, reject) => {
      AppleHealthKit.initHealthKit(HEALTH_PERMISSIONS, (error) => {
        if (error) {
          reject(error);
        } else {
          resolve(true);
        }
      });
    });
  } else if (Platform.OS === 'android') {
    const authorized = await GoogleFit.authorize(GOOGLE_FIT_OPTIONS);
    return authorized.success;
  }
  
  return false;
};

export const getTodaySteps = async () => {
  const today = new Date();
  const startOfDay = new Date(today.setHours(0, 0, 0, 0));
  
  if (Platform.OS === 'ios') {
    return new Promise((resolve) => {
      const options = {
        date: new Date().toISOString(),
        includeManuallyAdded: true,
      };
      
      AppleHealthKit.getStepCount(options, (err, results) => {
        if (err) {
          resolve(0);
        } else {
          resolve(results.value || 0);
        }
      });
    });
  } else if (Platform.OS === 'android') {
    const res = await GoogleFit.getDailyStepCountSamples({
      startDate: startOfDay.toISOString(),
      endDate: new Date().toISOString(),
    });
    
    if (res && res.length > 0) {
      const googleFitData = res.find(r => r.source === 'com.google.android.gms');
      return googleFitData?.steps?.value || 0;
    }
  }
  
  return 0;
};

export const getSleepData = async () => {
  const today = new Date();
  const startOfDay = new Date(today.setHours(0, 0, 0, 0));
  const endOfDay = new Date(today.setHours(23, 59, 59, 999));
  
  if (Platform.OS === 'ios') {
    return new Promise((resolve) => {
      const options = {
        startDate: startOfDay.toISOString(),
        endDate: endOfDay.toISOString(),
      };
      
      AppleHealthKit.getSleepSamples(options, (err, results) => {
        if (err || !results || results.length === 0) {
          resolve(0);
        } else {
          // Calculate total sleep in hours
          const totalMinutes = results.reduce((sum, sample) => {
            const start = new Date(sample.startDate);
            const end = new Date(sample.endDate);
            return sum + (end - start) / (1000 * 60);
          }, 0);
          
          resolve(totalMinutes / 60);
        }
      });
    });
  } else if (Platform.OS === 'android') {
    const res = await GoogleFit.getSleepSamples({
      startDate: startOfDay.toISOString(),
      endDate: endOfDay.toISOString(),
    });
    
    if (res && res.length > 0) {
      const totalMinutes = res.reduce((sum, sample) => {
        return sum + (sample.endDate - sample.startDate) / (1000 * 60);
      }, 0);
      
      return totalMinutes / 60;
    }
  }
  
  return 0;
};

export const getHeartRate = async () => {
  if (Platform.OS === 'ios') {
    return new Promise((resolve) => {
      const options = {
        unit: 'bpm',
        startDate: new Date(Date.now() - 60 * 60 * 1000).toISOString(), // Last hour
        endDate: new Date().toISOString(),
        ascending: false,
        limit: 1,
      };
      
      AppleHealthKit.getHeartRateSamples(options, (err, results) => {
        if (err || !results || results.length === 0) {
          resolve(null);
        } else {
          resolve(Math.round(results.value));
        }
      });
    });
  } else if (Platform.OS === 'android') {
    const res = await GoogleFit.getHeartRateSamples({
      startDate: new Date(Date.now() - 60 * 60 * 1000).toISOString(),
      endDate: new Date().toISOString(),
    });
    
    if (res && res.length > 0) {
      return Math.round(res[res.length - 1].value);
    }
  }
  
  return null;
};

export const syncAllHealthData = async () => {
  try {
    const [steps, sleep, heartRate] = await Promise.all([
      getTodaySteps(),
      getSleepData(),
      getHeartRate(),
    ]);
    
    return {
      steps,
      sleepHours: sleep,
      heartRate,
      lastSynced: new Date(),
    };
  } catch (error) {
    console.error('Health sync error:', error);
    return null;
  }
};

3.CREATE HEALTH SYNC SCREEN:

// screens/HealthSyncScreen.js

export default function HealthSyncScreen({ navigation }) {
  const [isConnected, setIsConnected] = useState(false);
  const [healthData, setHealthData] = useState(null);
  const [syncing, setSyncing] = useState(false);
  const [autoSync, setAutoSync] = useState(false);

  useEffect(() => {
    checkConnection();
    loadSyncSettings();
  }, []);

  const checkConnection = async () => {
    const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
    setIsConnected(userDoc.data().healthKitConnected || false);
  };

  const loadSyncSettings = async () => {
    const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
    setAutoSync(userDoc.data().autoSyncHealth || false);
  };

  const handleConnect = async () => {
    try {
      const initialized = await initializeHealthKit();
      
      if (initialized) {
        await updateDoc(doc(db, 'users', auth.currentUser.uid), {
          healthKitConnected: true,
          healthKitConnectedAt: new Date(),
        });
        
        setIsConnected(true);
        Alert.alert('Success', 'Health app connected!');
        
        // Perform initial sync
        handleSync();
      } else {
        Alert.alert('Error', 'Failed to connect to health app');
      }
    } catch (error) {
      Alert.alert('Connection Error', error.message);
    }
  };

  const handleSync = async () => {
    setSyncing(true);
    
    try {
      const data = await syncAllHealthData();
      
      if (data) {
        setHealthData(data);
        
        // Update Firebase
        await updateDoc(doc(db, 'users', auth.currentUser.uid), {
          healthData: data,
          lastHealthSync: new Date(),
        });
        
        Alert.alert('Synced!', `Steps: ${data.steps}\nSleep: ${data.sleepHours.toFixed(1)}hrs`);
      }
    } catch (error) {
      Alert.alert('Sync Error', error.message);
    } finally {
      setSyncing(false);
    }
  };

  const toggleAutoSync = async () => {
    const newValue = !autoSync;
    setAutoSync(newValue);
    
    await updateDoc(doc(db, 'users', auth.currentUser.uid), {
      autoSyncHealth: newValue,
    });
    
    if (newValue) {
      Alert.alert(
        'Auto-Sync Enabled',
        'Health data will sync automatically when you track activities'
      );
    }
  };

  return (
    <ScrollView style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.title}>Health App Sync</Text>
        <Text style={styles.subtitle}>
          Connect to {Platform.OS === 'ios' ? 'Apple Health' : 'Google Fit'}
        </Text>
      </View>

      {!isConnected ? (
        /* Not Connected State */
        <View style={styles.notConnected}>
          <Text style={styles.icon}>
            {Platform.OS === 'ios' ? '‚ù§Ô∏è' : 'üèÉ'}
          </Text>
          <Text style={styles.notConnectedTitle}>
            Sync with {Platform.OS === 'ios' ? 'Apple Health' : 'Google Fit'}
          </Text>
          <Text style={styles.notConnectedDesc}>
            Automatically track your steps, sleep, and heart rate without manual entry
          </Text>

          <View style={styles.benefits}>
            <View style={styles.benefit}>
              <Text style={styles.benefitIcon}>‚úì</Text>
              <Text style={styles.benefitText}>Auto-sync daily steps</Text>
            </View>
            <View style={styles.benefit}>
              <Text style={styles.benefitIcon}>‚úì</Text>
              <Text style={styles.benefitText}>Track sleep patterns</Text>
            </View>
            <View style={styles.benefit}>
              <Text style={styles.benefitIcon}>‚úì</Text>
              <Text style={styles.benefitText}>Monitor heart rate</Text>
            </View>
            <View style={styles.benefit}>
              <Text style={styles.benefitIcon}>‚úì</Text>
              <Text style={styles.benefitText}>Earn XP automatically</Text>
            </View>
          </View>

          <TouchableOpacity style={styles.connectBtn} onPress={handleConnect}>
            <Text style={styles.connectBtnText}>
              Connect {Platform.OS === 'ios' ? 'Apple Health' : 'Google Fit'}
            </Text>
          </TouchableOpacity>

          <Text style={styles.privacy}>
            üîí Your health data is private and never shared
          </Text>
        </View>
      ) : (
        /* Connected State */
        <View style={styles.connected}>
          <View style={styles.connectedHeader}>
            <Text style={styles.connectedIcon}>‚úì</Text>
            <Text style={styles.connectedText}>Connected</Text>
          </View>

          {/* Auto-Sync Toggle */}
          <View style={styles.settingRow}>
            <View style={styles.settingInfo}>
              <Text style={styles.settingLabel}>Auto-Sync</Text>
              <Text style={styles.settingDesc}>
                Sync automatically when tracking activities
              </Text>
            </View>
            <Switch
              value={autoSync}
              onValueChange={toggleAutoSync}
              trackColor={{ false: '#CCC', true: '#32808D' }}
            />
          </View>

          {/* Sync Button */}
          <TouchableOpacity
            style={styles.syncBtn}
            onPress={handleSync}
            disabled={syncing}
          >
            <Text style={styles.syncBtnText}>
              {syncing ? '‚è≥ Syncing...' : 'üîÑ Sync Now'}
            </Text>
          </TouchableOpacity>

          {/* Health Data Display */}
          {healthData && (
            <View style={styles.healthDataCard}>
              <Text style={styles.dataTitle}>Latest Sync</Text>
              
              <View style={styles.dataRow}>
                <Text style={styles.dataIcon}>üëü</Text>
                <Text style={styles.dataLabel}>Steps Today</Text>
                <Text style={styles.dataValue}>{healthData.steps.toLocaleString()}</Text>
              </View>

              <View style={styles.dataRow}>
                <Text style={styles.dataIcon}>üò¥</Text>
                <Text style={styles.dataLabel}>Sleep</Text>
                <Text style={styles.dataValue}>{healthData.sleepHours.toFixed(1)} hrs</Text>
              </View>

              {healthData.heartRate && (
                <View style={styles.dataRow}>
                  <Text style={styles.dataIcon}>‚ù§Ô∏è</Text>
                  <Text style={styles.dataLabel}>Heart Rate</Text>
                  <Text style={styles.dataValue}>{healthData.heartRate} bpm</Text>
                </View>
              )}

              <Text style={styles.lastSynced}>
                Last synced: {new Date(healthData.lastSynced).toLocaleTimeString()}
              </Text>
            </View>
          )}

          {/* Disconnect Option */}
          <TouchableOpacity
            style={styles.disconnectBtn}
            onPress={() => {
              Alert.alert(
                'Disconnect',
                'Are you sure? You\'ll need to enter data manually.',
                [
                  { text: 'Cancel', style: 'cancel' },
                  {
                    text: 'Disconnect',
                    style: 'destructive',
                    onPress: async () => {
                      await updateDoc(doc(db, 'users', auth.currentUser.uid), {
                        healthKitConnected: false,
                        autoSyncHealth: false,
                      });
                      setIsConnected(false);
                      setAutoSync(false);
                    },
                  },
                ],
              );
            }}
          >
            <Text style={styles.disconnectBtnText}>Disconnect</Text>
          </TouchableOpacity>
        </View>
      )}
    </ScrollView>
  );
}

4.INTEGRATE INTO TRACK SCREEN:

// Update TrackScreen.js to auto-sync

const [healthSyncEnabled, setHealthSyncEnabled] = useState(false);

useEffect(() => {
  checkHealthSync();
}, []);

const checkHealthSync = async () => {
  const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
  const autoSync = userDoc.data().autoSyncHealth || false;
  setHealthSyncEnabled(autoSync);
  
  if (autoSync) {
    // Auto-fill from health app
    const data = await syncAllHealthData();
    if (data) {
      setSteps(data.steps.toString());
      setSleepHours(data.sleepHours.toFixed(1));
    }
  }
};

// Add sync button
<TouchableOpacity
  style={styles.syncBtn}
  onPress={async () => {
    const data = await syncAllHealthData();
    if (data) {
      setSteps(data.steps.toString());
      setSleepHours(data.sleepHours.toFixed(1));
      Alert.alert('Synced!', 'Health data updated');
    }
  }}
>
  <Text style={styles.syncBtnText}>üîÑ Sync from Health App</Text>
</TouchableOpacity>

Create complete health app integration with:

Apple Health Kit support

Google Fit support

Auto-sync capability

Manual sync option

Privacy-focused permissions

Real-time data display

Seamless tracking screen integration

